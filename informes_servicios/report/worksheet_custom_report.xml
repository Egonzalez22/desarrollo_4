<?xml version='1.0' encoding='utf-8'?>
<odoo>
    <data>
        <template id="worksheet_custom_page" inherit_id="industry_fsm.worksheet_custom_page">
            <xpath expr="//div[@class='page']/div" position="before">
                <div style="text-align:right">
                    <h4>
                        <span t-esc="str(doc.id).zfill(7)" /> <br /> Reporte de Servicio </h4>
                    <t t-if="doc.helpdesk_ticket_id.nro_contrato">
                        <div>
                            <strong>Nro Contrato: </strong>
                            <span t-esc="doc.helpdesk_ticket_id.nro_contrato" />
                        </div>
                    </t>
                </div>
            </xpath>
            <xpath expr="//div[@name='worksheet_task_timesheet']" position="before">
                <h2>
                    <span t-field="doc.worksheet_template_id.name" />
                </h2>
                <div class="mt-3">
                    <div class="row">
                        <div class="col-6">
                            <h6>
                                <strong>Fecha de servicio: </strong>
                                <t t-if="doc.timesheet_ids">
                                    <span t-field="doc.timesheet_ids[0].date" />
                                </t>
                            </h6>
                            <h6>
                                <strong>Cliente: </strong>
                                <span t-field="doc.helpdesk_ticket_id.partner_id" />
                            </h6>
                            <h6>
                                <strong>Equipo: </strong>
                                <span t-field="doc.helpdesk_ticket_id.product_id" />
                            </h6>
                            <h6>
                                <strong>Marca: </strong>
                                <span t-field="doc.helpdesk_ticket_id.x_studio_related_field_PioGN" />
                                <!-- <span t-field="doc.helpdesk_ticket_id.x_studio_related_field_gJ8nu" /> -->
                            </h6>
                            <h6>
                                <strong>Modelo/ID: </strong>
                                <span t-field="doc.helpdesk_ticket_id.x_studio_cdigo_cliente_1" />
                                <!-- <span t-field="doc.helpdesk_ticket_id.x_studio_cdigo_cliente" /> -->
                            </h6>
                        </div>

                        <div class="col-6">
                            <h6>
                                <strong>Nro. de serie: </strong>
                                <span t-field="doc.helpdesk_ticket_id.lot_id" />
                            </h6>
                            <h6>
                                <strong>Nro. de contrato: </strong>
                                <span t-field="doc.helpdesk_ticket_id.nro_contrato" />
                            </h6>
                            <h6>
                                <strong>Persona de contacto: </strong>
                                <span t-field="doc.helpdesk_ticket_id.atencion_de" />
                            </h6>
                            <h6>
                                <strong>Hora de inicio/hora de fin: </strong>
                                <span t-field="doc.planned_hours" t-options="{'widget': 'float_time'}" />
                            </h6>
                            <h6>
                                <strong>Tipo de servicio: </strong>
                                <span t-field="doc.helpdesk_ticket_id.ticket_type_id" />
                            </h6>
                        </div>
                    </div>
                    <div class="row" style="padding-top: 1em;">
                        <div class="col-12">
                            <h6>
                                <strong>Descripción de falla: </strong>
                                <span t-field="doc.descripcion_falla" />
                            </h6>
                            <h6>
                                <strong>Descripción del trabajo realizado: </strong>
                                <span t-field="doc.descripcion_trabajo" />
                            </h6>
                            <h6>
                                <strong>Materiales reemplazados: </strong>
                                <span t-field="doc.materiales_reemplazado" />
                            </h6>
                        </div>
                    </div>
                </div>

            </xpath>

            <xpath expr="//thead//tr//th[3]" position="after">
                <th class="text-start">Hora de inicio</th>
                <th class="text-start">Hora de fin</th>
            </xpath>

            <xpath expr="//tbody[@class='sale_tbody']" position="replace">
                <t t-foreach="doc.timesheet_ids" t-as="line">
                    <tr t-att-style="'background-color: #F1F1F1;' if line_index % 2 == 0 else ''">
                        <td>
                            <span t-field="line.date" />
                        </td>
                        <td>
                            <span t-field="line.employee_id.name" />
                        </td>
                        <td class="text-start">
                            <span t-field="line.display_name" />
                        </td>
                        <td class="text-start">
                            <span t-field="line.hora_inicio" t-options="{'widget': 'float_time'}" />
                        </td>
                        <td class="text-start">
                            <span t-field="line.hora_fin" t-options="{'widget': 'float_time'}" />
                        </td>
                        <td class="text-end">
                            <t t-if="is_uom_day">
                                <span t-out="line._convert_hours_to_days(line.unit_amount)"
                                    t-options="{&quot;widget&quot;: &quot;timesheet_uom&quot;}" />
                            </t>
                            <t t-else="">
                                <span t-out="line.unit_amount" t-options="{'widget': 'float_time'}" />
                            </t>
                        </td>
                    </tr>
                </t>
            </xpath>

            <xpath expr="//div[@name='worksheet_task_timesheet']//h2" position="replace">
                <br />
                <h4>Partes de horas</h4>
            </xpath>

            <xpath expr="//div[@class='page']" position="inside">
                <div class="footer o_background_footer">
                    <div class="row mt-4">
                        <div class="col-6 text-center">
                            <div style="width: 80%; margin: 0 auto;">
                                <div
                                    style="border-top: 1px solid black; margin-top: 50px; padding-top: 5px;">
                                    <span t-field="doc.helpdesk_ticket_id.user_id.name" />
                                </div>
                            </div>
                        </div>

                        <div class="col-6 text-center">
                            <div style="width: 80%; margin: 0 auto;">
                                <div
                                    style="border-top: 1px solid black; margin-top: 50px; padding-top: 5px;">
                                    <span t-field="doc.helpdesk_ticket_id.atencion_de.name" />
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </xpath>
        </template>
    </data>
</odoo>