<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>

        <!-- account.move inherit form view -->
        <record id="view_move_form" model="ir.ui.view">
            <field name="name">view_move_form</field>
            <field name="model">account.move</field>
            <field name="inherit_id" ref="account.view_move_form" />
            <field name="arch" type="xml">
                <xpath expr="//field[@name='payment_reference']" position="after">

                    <field name="tipo_documento" invisible="1" />
                    <field name="documento_electronico" invisible="1" />
                    <field name="es_fact_credito" invisible="1" />

                    <!-- Tipo de impuesto e indicador de presencia obligatorio para todos -->
                    <field
                        name="iTImp"
                        attrs="{'invisible': [('tipo_documento', 'not in', ('out_invoice', 'autofactura', 'out_refund', 'nota_debito'))], 'readonly': [('state', '!=', 'draft')],'required': [('documento_electronico','=',True),('tipo_documento', 'in', ('out_invoice', 'autofactura', 'out_refund', 'nota_debito'))]}" />
                    <field
                        name="indicador_presencia"
                        attrs="{'invisible': [('tipo_documento', 'not in', ('out_invoice', 'autofactura', 'out_refund', 'nota_debito'))], 'readonly': [('state', '!=', 'draft')], 'required': [('documento_electronico','=',True),('tipo_documento', 'in', ('out_invoice', 'autofactura', 'out_refund', 'nota_debito'))]}" />
                    <field
                        name="tipo_operacion"
                        attrs="{'invisible': [('tipo_documento', 'not in', ('out_invoice', 'autofactura', 'out_refund', 'nota_debito'))], 'readonly': [('estado_set', 'not in', ['borrador','rechazado'])], 'required': [('documento_electronico','=',True),('tipo_documento', 'in', ('out_invoice', 'autofactura', 'out_refund', 'nota_debito'))]}" />

                    <!-- Tipo de transaccion obligatorio para facturas y autofacturas -->
                    <field
                        name="iTipTra"
                        attrs="{'invisible': [('tipo_documento', 'not in', ('out_invoice', 'autofactura'))], 'readonly': [('state', '!=', 'draft')], 'required': [('documento_electronico','=',True),('tipo_documento', 'in', ('out_invoice', 'autofactura'))]}" />

                    <!-- Para autofactura -->
                    <field
                        name="naturaleza_vendedor"
                        attrs="{'invisible': [('tipo_documento', 'not in', ('autofactura'))], 'readonly': [('state', '!=', 'draft')], 'required': [('documento_electronico','=',True),('tipo_documento', 'in', ('autofactura'))]}" />

                    <!-- obligatorio para NCE y NDE -->
                    <field
                        name="motivo_emision"
                        attrs="{'invisible': [('tipo_documento', 'not in', ('out_refund', 'nota_debito'))], 'readonly': [('state', '!=', 'draft')], 'required': [('documento_electronico','=',True),('tipo_documento', 'in', ('out_refund', 'nota_debito'))]}" />
                    <field
                        name="nro_factura_asociada"
                        options="{'no_create':True,'no_create_edit': True}"
                        domain="[('state','=','posted'), ('partner_id', '=', partner_id), ('move_type', '=' ,'out_invoice')]"
                        attrs="{'invisible': [('tipo_documento', 'not in', ('out_refund', 'nota_debito'))], 'readonly': [('state', '!=', 'draft')], 'required': [('documento_electronico','=',True),('tipo_documento', 'in', ('out_refund', 'nota_debito'))]}" />

                    <!-- Campos solo para facturas de venta -->
                    <!-- <field
                        name="factura_anticipo_id"
                        options="{'no_create':True,'no_create_edit': True}"
                        domain="[('state','=','posted'), ('partner_id', '=', partner_id)]"
                        attrs="{'invisible': [('move_type', 'not in', ('out_invoice'))], 'readonly': [('state', '!=', 'draft')]}" /> -->
                    <field
                        name="nota_remision_asociadas"
                        widget="many2many_tags"
                        attrs="{'invisible': [('move_type', 'not in', ('out_invoice'))], 'readonly': [('state', '!=', 'draft')]}"
                        options="{'no_create':True,'no_create_edit': True}"
                        domain="[('state','=','posted'), ('invoice_id','=', False), ('partner_id', '=', partner_id)]" />
                    <field
                        name="facturas_anticipo_asociadas"
                        widget="many2many_tags"
                        options="{'no_create':True,'no_create_edit': True}"
                        domain="[('state','=','posted'),('partner_id', '=', partner_id), ('iTipTra', '=', '9')]"
                        attrs="{'invisible': [('move_type', 'not in', ('out_invoice'))], 'readonly': [('state', '!=', 'draft')]}" />

                    <!-- Para factura a credito -->
                    <field
                        name="condicion_credito"
                        attrs="{'invisible': [('es_fact_credito', '=', False), ('tipo_documento', 'not in', ('out_invoice'))], 'readonly': [('state', '!=', 'draft')]}" />

                    <!-- Estado de la set -->
                    <field
                        name="estado_set"
                        string="Estado SET"
                        readonly="1"
                        attrs="{'invisible': [('move_type', 'not in', ('out_invoice', 'out_refund'))]}" />

                </xpath>

                <!-- Agregamos un boton en el header -->
                <!-- <xpath expr="//header" position="inside">
                    <button
                        name="action_imprimir_ticket"
                        string="Imprimir Ticket"
                        type="object"
                        class="oe_highlight"
                        attrs="{'invisible': [('documento_electronico', '=', False)]}"
                    />
                </xpath> -->
            </field>
        </record>

        <record model="ir.ui.view" id="account_view_invoice_tree_tree_tree_inherit_fe">
            <field name="name">account_view_invoice_tree_tree_tree_inherit_fe</field>
            <field name="model">account.move</field>
            <field name="inherit_id" ref="account.view_invoice_tree" />
            <field name="arch" type="xml">
                <xpath expr="//tree" position="inside">
                    <field
                        name="estado_set"
                        string="Estado SET"
                        widget="badge"
                        decoration-warning="estado_set == 'preparado'"
                        decoration-info="estado_set in ['ingresado', 'lote_reenviando']"
                        decoration-success="estado_set == 'aprobado'"
                        decoration-danger="estado_set in ['rechazado', 'inutilizado', 'cancelado', 'error_sifen', 'lote_rechazado']"
                        optional="hide"
                    />
                    <field
                        name="mensaje_set_detalle"
                        string="Mensaje SET"
                        optional="hide"
                    />
                    <field name="motivo_cancelacion" string="Motivo de cancelaciÃ³n" optional="hide"/>
                </xpath>
            </field>
        </record>

    </data>
</odoo>