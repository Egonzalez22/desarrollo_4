<odoo>
    <data>
        <record id="factura_multi_pago.payment_group_tree" model="ir.ui.view">
            <field name="name">factura_multi_pago.payment_group.tree</field>
            <field name="model">factura_multi_pago.payment_group</field>
            <field name="arch" type="xml">
                <tree decoration-muted="state=='cancel'" decoration-info="state=='draft'">
                    <field name="name"/>
                    <field name="fecha"/>
                    <field name="partner_id" string="Cliente"/>
                    <field name="amount_total"/>
                    <field name="total_confirmado"/>
                    <field name="saldo_total"/>
                    <field name="memo"/>
                    <field name="state"/>
                </tree>
            </field>
        </record>

        <record id="factura_multi_pago.payment_group_frorm" model="ir.ui.view">
            <field name="name">factura_multi_pago.payment_group.form</field>
            <field name="model">factura_multi_pago.payment_group</field>
            <field name="arch" type="xml">
                <form>
                    <header>
                        <field name="state" widget="statusbar" />
                        <field name="has_draft_lines" invisible="1" />
                        <field name="has_done_lines" invisible="1" />
                        <field name="is_valid" invisible="1" />
                        <button
                            string="Confirmar"
                            type="object"
                            name="button_confirmar"
                            class="oe_highlight"
                            attrs="{'invisible':['|', ('has_draft_lines', '!=', True), ('is_valid', '=', False)]}"
                        />
                        <button
                            string="Cancelar"
                            type="object"
                            name="button_cancelar"
                            attrs="{'invisible':['|', ('state', '=', 'cancel'), ('has_done_lines', '!=', True)]}"
                        />
                        <button
                            string="Convertir a borrador"
                            type="object"
                            name="button_draft"
                            attrs="{'invisible':[('state','!=','cancel')]}"
                        />
                    </header>
                    <sheet>
                        <div style="width: 100%; padding-bottom: 7px;">
                            <field
                                name="error_msg"
                                style="color: red;"
                                nolabel="1"
                                attrs="{'invisible': [('error_msg', '=', '')]}"
                            />
                        </div>

                        <group>
                            <group>
                                <field name="name" />
                                <field name="partner_id" />
                                <field name="currency_id" />
                                <field name="amount_total" />
                                <field name="total_confirmado"/>
                                <field name="saldo_total"/>
                                <field name="memo" />
                                <field name="tipo" value="proveedor" invisible="1"/>
                            </group>
                            <group></group>

                            <notebook>
                                <page name="payment_group_lines" string="Líneas de grupo de pago">
                                    <field name="group_line_ids" context="{'default_payment_group_id': active_id}">
                                        <tree editable="bottom">
                                            <field name="id" />
                                            <field name="tipo_pago" />
                                            <field name="journal_id" />
                                            <field name="bank_id" />
                                            <field name="nro_documento" />
                                            <field name="nro_cheque" />
                                            <field name="fecha_cheque" />
                                            <field name="fecha_venc_cheque" />

                                            <field name="amount" />
                                            <field name="saldo_total" />
                                        </tree>
                                        <form>
                                            <group>
                                                <group>
                                                    <field name="amount" />
                                                    <field name="journal_id" />
                                                    <field name="bank_id" />
                                                    <field name="nro_documento" />
                                                    <field name="nro_cheque" />
                                                    <field name="fecha_cheque" />
                                                    <field name="fecha_venc_cheque" />
                                                </group>
                                            </group>
                                        </form>
                                    </field>
                                </page>
                                <page name="payment_group_distribution" string="Distribución de pago">
                                    <field name="payment_group_distribution_ids" context="{'default_payment_group_id': active_id}">
                                        <tree editable="bottom">
                                            <field
                                                name="payment_group_line_id"
                                                domain="[('payment_group_id', '=', parent.id)]"
                                            />
                                            <field
                                                name="account_move_id"
                                                domain="[('partner_id', '=', parent.partner_id)]"
                                            />
                                            <field name="done" readonly="1" />
                                            <!--<field name="account_move_line_id" />-->
                                            <field name="total_factura" />
                                            <field name="total_pendiente" />
                                            <field name="amount" />
                                        </tree>
                                        <form>
                                            <group>
                                                <group>
                                                    <field
                                                        name="payment_group_line_id"
                                                        domain="[('payment_group_id', '=', parent.id)]"
                                                        options="{'no_create': True}"
                                                    />
                                                    <field
                                                        name="account_move_id"
                                                        domain="[('partner_id', '=', parent.partner_id)]"
                                                        options="{'no_create': True}"
                                                    />
                                                    <field name="done" readonly="1" />
                                                    <!--
                                                    <field
                                                        name="account_move_line_id"
                                                        domain="[('move_id', '=', account_move_id)]"
                                                        options="{'no_create': True}"
                                                        attrs="{'invisible': [('account_move_id', '=', False)]}"
                                                    />
                                                    -->
                                                    <field name="total_factura" />
                                                    <field name="total_pendiente" />
                                                    <field name="amount" />
                                                </group>
                                            </group>
                                        </form>
                                    </field>
                                </page>

                                <page name="payment_group_moves" string="Facturas">
                                    <field name="invoice_ids" />
                                </page>

                                <page name="payment_group_payments" string="Pagos">
                                    <field name="payment_ids" />
                                </page>

                            </notebook>
                        </group>
                    </sheet>
                </form>
            </field>
        </record>

        <record model="ir.actions.act_window" id="factura_multi_pago.payment_group_action_window">
            <field name="name">Recibo de cliente</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">factura_multi_pago.payment_group</field>
            <field name="view_mode">tree,form</field>
            <field name="domain">[('tipo', '=', 'cliente')]</field>
            <field name="context" eval="{'default_tipo': 'cliente' }"/>
        </record>

        <record model="ir.actions.act_window" id="factura_multi_pago.payment_group_proveedor_action_window">
            <field name="name">Recibo de proveedor</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">factura_multi_pago.payment_group</field>
            <field name="view_mode">tree,form</field>
            <field name="domain">[('tipo', '=', 'proveedor')]</field>
            <field name="context" eval="{'default_tipo': 'proveedor' }"/>
        </record>

        <menuitem
            name="Recibos de clientes"
            id="factura_multi_pago.menu_recibos"
            parent="account.menu_finance_receivables"
            action="factura_multi_pago.payment_group_action_window"
        />
        <menuitem
            name="Recibos de proveedores"
            id="factura_multi_pago.menu_recibos_proveedores"
            parent="account.menu_finance_payables"
            action="factura_multi_pago.payment_group_proveedor_action_window"
        />
    </data>
</odoo>
