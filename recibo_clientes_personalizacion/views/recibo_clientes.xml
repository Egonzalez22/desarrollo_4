<?xml version="1.0" encoding="utf-8"?>
<odoo>
  <data>
    <template id="recibo_clientes_personalizacion"
              inherit_id="grupo_account_payment.template_recibo">
      <xpath expr="." position="replace">
        <t t-call="web.html_container">
          <t t-call="web.external_layout">
            <t t-set="o" t-value="o.with_context({'lang': o.partner_id.lang})"/>

            <!-- Estilos heredados de interfaces_payment -->
            <style type="text/css">
              hr{ border-top:1px solid black; }
              th,tr,td{ font-size:12px; padding:2px; }
              th{ text-align:center; }
              .numero{ text-align:right; }
              .izquierda{ text-align:left; }
              /* Watermark “duplicado” */
              #duplicado{
                position:absolute; z-index:0; background:white;
                display:block; min-height:50%; min-width:50%; color:yellow;
              }
              /* Fondo gris rotado */
              #bg-text{
                color:lightgrey; font-size:90px;
                transform:rotate(300deg); -webkit-transform:rotate(300deg);
              }
              .page{ z-index:1; }
            </style>

            <t t-foreach="range(2)" t-as="katsuragi">
              <div class="page" id="original">

                <!-- Encabezado -->
                <div>
                  <h3 style="text-align:center">Recibo de dinero</h3>
                  <table style="width:100%;">
                    <td class="izquierda" style="width:50%">
                      <strong>Número:</strong>
                      <span t-esc="o.nro_recibo_fisico"/>
                      <br/>
                      <strong>Fecha:</strong>
                      <span t-field="o.fecha"/>
                      <br/>
                    </td>
                    <td style="width:50%">
                      <strong>Monto total:</strong>
                      <span t-esc="env['interfaces_tools.tools'].format_amount(o.amount_total, o.currency_id)"/>
                      <span t-field="o.currency_id.symbol"/>
                      <br/>
                      <strong>Usuario:</strong>
                      <span t-esc="o.user_id.name"/>
                      <br/>
                    </td>
                  </table>
                </div>

                <!-- Datos del partner con anchuras fijas -->
                <div style="font-size:12px;">
                  <table style="width:100%;">
                    <colgroup>
                      <col style="width:20%;"/>
                      <col style="width:80%;"/>
                    </colgroup>
                    <tr>
                      <td><strong>Recibimos de:</strong></td>
                      <td><span t-field="o.partner_id.name"/></td>
                    </tr>
                    <tr>
                      <td><strong>RUC:</strong></td>
                      <td><span t-field="o.partner_id.vat"/></td>
                    </tr>
                    <tr>
                      <td><strong>La cantidad de:</strong></td>
                      <td style="font-style:italic;background-color:gray;border-radius:6px;padding:7px">
                        <span t-esc="o.currency_id.currency_unit_label"/>
                        <span t-esc="env['interfaces_tools.tools'].numero_a_letra(o.amount_total)"/>
                      </td>
                    </tr>
                    <tr>
                      <td><strong>En concepto de:</strong></td>
                      <td>Pago según se detalla</td>
                    </tr>
                  </table>
                </div>

                <!-- Tabla de facturas -->
                <table style="width:60%;margin-right:100%;">
                  <tr>
                    <td colspan="4" style="text-align:center">
                      <strong>Facturas</strong>
                    </td>
                  </tr>
                  <tr style="border:1px solid black;border-radius:12px">
                    <th>Fecha</th>
                    <th>Empresa</th>
                    <th>Nro. Factura</th>
                    <th>Monto</th>
                  </tr>
                  <t t-foreach="o.paid_invoice_ids" t-as="i">
                    <tr>
                      <td><span t-field="i.invoice_date"/></td>
                      <td><span t-field="o.partner_id.name"/></td>
                      <td><span t-field="i.name"/></td>
                      <td class="numero">
                        <span t-esc="i.currency_id.symbol"/>
                        <span t-esc="env['interfaces_tools.tools'].format_amount(i.amount_total, i.currency_id)"/>
                      </td>
                    </tr>
                  </t>
                </table>

                <!-- Tabla de líneas de pago -->
                <table style="width:100%">
                  <tr>
                    <td colspan="4" style="text-align:center">
                      <strong>Líneas de pago</strong>
                    </td>
                  </tr>
                  <tr style="border:1px solid black;">
                    <th>Tipo</th>
                    <th>Banco</th>
                    <th>Nro. documento</th>
                    <th>Monto</th>
                  </tr>
                  <t t-foreach="o.payment_ids" t-as="l">
                    <tr>
                      <td style="text-align:left"><span t-field="l.tipo_pago"/></td>
                      <td style="text-align:left"><span t-field="l.bank_id.name"/></td>
                      <td style="text-align:center">
                        <t t-if="l.tipo_pago=='Efectivo'"/>
                        <t t-elif="l.tipo_pago=='Cheque'"><span t-field="l.nro_cheque"/></t>
                        <t t-elif="l.tipo_pago in ['TCredito','Transferencia','Retencion']">
                          <span t-field="l.nro_documento"/>
                        </t>
                      </td>
                      <td class="numero">
                        <span t-esc="l.currency_id.symbol"/>
                        <span t-esc="env['interfaces_tools.tools'].format_amount(l.amount, l.currency_id)"/>
                      </td>
                    </tr>
                  </t>
                </table>

                <!-- Original / Duplicado -->
                <br/>
                <div style="text-align:right;font-weight:700;font-style:italic;color:#A0A0A0;">
                  <t t-if="katsuragi &lt; 1">
                    <span style="font-size:12px;">Original</span>
                  </t>
                  <t t-else="">
                    <span style="font-size:12px;">Duplicado</span>
                  </t>
                </div>

                <!-- Separador final -->
                <hr style="color:black"/>
                <br/>

              </div>
            </t>
          </t>
        </t>
      </xpath>
    </template>

    <!-- Se sobreescribe valores del paperformat del reporte para usar base.paperformat_us -->
    <record id="grupo_account_payment.reporte_pagos" model="ir.actions.report">
      <field name="paperformat_id" ref="base.paperformat_us"/>
    </record>
  </data>
</odoo>
